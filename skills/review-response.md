---
name: review-response
description: Respond to PR review comments, addressing false positives and documenting decisions
argument-hint: "<pr-number> [--false-positive | --decision | --all]"
---

# Review Response Skill

Analyze the latest review comments on a PR and generate responses that:
1. Address false positives with evidence
2. Document implementation decisions
3. Acknowledge valid suggestions with action plans

## Workflow

### Step 1: Fetch Latest Review Comments

```bash
PR_NUM="${1:-$(gh pr view --json number --jq '.number' 2>/dev/null)}"

# Get latest review
gh api "repos/{owner}/{repo}/pulls/$PR_NUM/reviews" \
  --jq 'sort_by(.submitted_at) | .[-1] | {id: .id, state: .state, body: .body}'
```

### Step 2: Analyze Comments

For each comment, classify as:
- **False Positive**: Suggestion doesn't apply to current code
- **Valid - Addressed**: Already fixed in subsequent commits
- **Valid - Deferred**: Acknowledge for future work
- **Decision Point**: Documents a design choice

### Step 3: Generate Response Comment

Use this template:

```markdown
## Pre-Push Guardian Analysis

### False Positives Identified

| Line | Suggestion | Finding |
|------|------------|---------|
| `file.ts:123` | "Missing null check" | âœ… Already guarded at line 120 |

### Decisions Made

- **[Decision]**: Chose X over Y because [reason]
- **[Deferred]**: [Suggestion] noted for [future milestone]

### Pattern Notes

> ðŸ’¡ **Potential Skill**: This review flagged [pattern]. Consider adding a skill to [handle/validate] this pattern automatically.

---
*Generated by gitops-devex*
```

### Step 4: Post Comment

```bash
# Post response comment
gh pr comment "$PR_NUM" --body "$(cat response.md)"
```

## Example Usage

```bash
# Respond to all comments on current branch's PR
/review-response

# Respond only to false positives on PR #27
/review-response 27 --false-positive

# Document decisions only
/review-response 28 --decision
```

## Pattern Detection

When analyzing reviews, look for recurring themes that could become skills:

| Pattern | Potential Skill |
|---------|-----------------|
| "Missing type annotation" | `/type-check` - verify types before push |
| "Consider adding tests" | `/test-coverage` - check coverage delta |
| "Duplicate code detected" | `/dedup-check` - find similar code blocks |
| "Security concern" | `/security-scan` - run security linters |

## Response Templates

### False Positive Response

```markdown
**Re: [suggestion]**

This appears to be a false positive. Evidence:
- Line [X] shows [actual code behavior]
- [Context explaining why suggestion doesn't apply]

*Flagged by gitops-devex for review accuracy improvement*
```

### Decision Documentation

```markdown
**Design Decision: [topic]**

**Chosen approach**: [what was implemented]
**Alternatives considered**: [other options]
**Rationale**: [why this approach]

*Documented by gitops-devex*
```
